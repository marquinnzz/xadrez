<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xadrez Completo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .tabuleiro {
            display: grid;
            grid-template-columns: repeat(8, 50px);
            grid-template-rows: repeat(8, 50px);
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .casa {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            cursor: pointer;
            position: relative;
        }
        .clara { background-color: #f0d9b5; }
        .escura { background-color: #b58863; }
        .selecionada { background-color: #ffcc00 !important; }
        .peca.branca { color: #FFFFFF; text-shadow: 1px 1px 2px #000; }
        .peca.preta { color: #333333; }
        .guia-movimento {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: green;
            border-radius: 50%;
            pointer-events: none; /* Permite o clique na casa, não na bolinha */
        }
        
        #mensagem {
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: bold;
        }
        .opcoes-jogo {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #337ab7;
            color: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Xadrez Simples</h1>
    <div class="container">
        <div class="opcoes-jogo">
            <button onclick="definirModo('amigo')">Jogar contra amigo</button>
            <button onclick="definirModo('ia')">Jogar contra IA</button>
        </div>
        <div class="tabuleiro" id="tabuleiro"></div>
        <div id="mensagem">É a vez das Brancas</div>
        <button onclick="reiniciarJogo()">Reiniciar Jogo</button>
    </div>

    <script>
        const tabuleiroEl = document.getElementById('tabuleiro');
        const mensagemEl = document.getElementById('mensagem');
        
        const pecasUnicode = {
            'r': '&#9820;', 'n': '&#9822;', 'b': '&#9821;', 'q': '&#9819;', 'k': '&#9818;', 'p': '&#9823;',
            'R': '&#9814;', 'N': '&#9816;', 'B': '&#9815;', 'Q': '&#9813;', 'K': '&#9812;', 'P': '&#9817;'
        };

        let tabuleiro;
        let turno;
        let pecaSelecionada;
        let modoDeJogo = 'amigo'; // 'amigo' ou 'ia'

        function definirModo(modo) {
            modoDeJogo = modo;
            alert(`Modo de jogo definido para: ${modo}. Reinicie o jogo para aplicar.`);
        }

        function reiniciarJogo() {
            tabuleiro = [
                ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
                ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
                ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
            ];
            turno = 'branco';
            pecaSelecionada = null;
            mensagemEl.textContent = 'É a vez das Brancas';
            renderizarTabuleiro();
        }

        function renderizarTabuleiro() {
            tabuleiroEl.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const casaEl = document.createElement('div');
                    casaEl.classList.add('casa');
                    casaEl.classList.add((i + j) % 2 === 0 ? 'clara' : 'escura');
                    casaEl.dataset.linha = i;
                    casaEl.dataset.coluna = j;
                    
                    const peca = tabuleiro[i][j];
                    if (peca) {
                        const pecaEl = document.createElement('span');
                        pecaEl.classList.add('peca');
                        pecaEl.classList.add(peca === peca.toUpperCase() ? 'branca' : 'preta');
                        pecaEl.innerHTML = pecasUnicode[peca];
                        casaEl.appendChild(pecaEl);
                    }
                    
                    casaEl.addEventListener('click', () => handleClick(i, j));
                    tabuleiroEl.appendChild(casaEl);
                }
            }
            if (pecaSelecionada) {
                mostrarMovimentosValidos(pecaSelecionada[0], pecaSelecionada[1]);
            }
        }

        function mostrarMovimentosValidos(linha, coluna) {
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const peca = tabuleiro[linha][coluna];
                    if (movimentoValido(peca, linha, coluna, i, j)) {
                        const casaAlvo = document.querySelector(`.casa[data-linha="${i}"][data-coluna="${j}"]`);
                        const guia = document.createElement('div');
                        guia.classList.add('guia-movimento');
                        casaAlvo.appendChild(guia);
                    }
                }
            }
        }

        function handleClick(linha, coluna) {
            const pecaNaCasa = tabuleiro[linha][coluna];

            if (pecaSelecionada) {
                const [pecaLinha, pecaColuna] = pecaSelecionada;
                const peca = tabuleiro[pecaLinha][pecaColuna];

                if (movimentoValido(peca, pecaLinha, pecaColuna, linha, coluna)) {
                    tabuleiro[linha][coluna] = peca;
                    tabuleiro[pecaLinha][pecaColuna] = '';
                    trocarTurno();
                }

                pecaSelecionada = null;
                renderizarTabuleiro();
            } else {
                if (pecaNaCasa && ((turno === 'branco' && pecaNaCasa === pecaNaCasa.toUpperCase()) || (turno === 'preto' && pecaNaCasa === pecaNaCasa.toLowerCase()))) {
                    pecaSelecionada = [linha, coluna];
                    const casaSelecionada = document.querySelector(`.casa[data-linha="${linha}"][data-coluna="${coluna}"]`);
                    casaSelecionada.classList.add('selecionada');
                    renderizarTabuleiro(); // Redesenha para mostrar os guias
                }
            }
        }

        function movimentoValido(peca, origemLinha, origemColuna, destinoLinha, destinoColuna) {
            const pecaDestino = tabuleiro[destinoLinha][destinoColuna];
            if (pecaDestino) {
                const corOrigem = peca === peca.toUpperCase() ? 'branco' : 'preto';
                const corDestino = pecaDestino === pecaDestino.toUpperCase() ? 'branco' : 'preto';
                if (corOrigem === corDestino) return false;
            }

            const pecaTipo = peca.toLowerCase();

            switch (pecaTipo) {
                case 'p': return movimentoPeao(peca, origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'r': return movimentoTorre(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'n': return movimentoCavalo(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'b': return movimentoBispo(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'q': return movimentoRainha(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'k': return movimentoRei(origemLinha, origemColuna, destinoLinha, destinoColuna);
                default: return false;
            }
        }
        
        function movimentoPeao(peca, oL, oC, dL, dC) {
            const direcao = (peca === peca.toUpperCase()) ? -1 : 1;
            const linhaInicial = (peca === peca.toUpperCase()) ? 6 : 1;
            
            // Movimento normal de 1 casa
            if (oL + direcao === dL && oC === dC && tabuleiro[dL][dC] === '') return true;

            // Movimento inicial de 2 casas
            if (oL === linhaInicial && oL + 2 * direcao === dL && oC === dC && tabuleiro[dL][dC] === '' && tabuleiro[oL + direcao][oC] === '') return true;

            // Captura
            if (oL + direcao === dL && Math.abs(oC - dC) === 1 && tabuleiro[dL][dC] !== '') return true;

            return false;
        }

        function movimentoTorre(oL, oC, dL, dC) {
            if (oL !== dL && oC !== dC) return false;
            const deltaL = dL - oL;
            const deltaC = dC - oC;
            const passoL = Math.sign(deltaL);
            const passoC = Math.sign(deltaC);
            let tempL = oL + passoL;
            let tempC = oC + passoC;
            while (tempL !== dL || tempC !== dC) {
                if (tabuleiro[tempL][tempC] !== '') return false;
                tempL += passoL;
                tempC += passoC;
            }
            return true;
        }

        function movimentoCavalo(oL, oC, dL, dC) {
            const deltaL = Math.abs(dL - oL);
            const deltaC = Math.abs(dC - oC);
            return (deltaL === 2 && deltaC === 1) || (deltaL === 1 && deltaC === 2);
        }

        function movimentoBispo(oL, oC, dL, dC) {
            if (Math.abs(dL - oL) !== Math.abs(dC - oC)) return false;
            const deltaL = dL - oL;
            const deltaC = dC - oC;
            const passoL = Math.sign(deltaL);
            const passoC = Math.sign(deltaC);
            let tempL = oL + passoL;
            let tempC = oC + passoC;
            while (tempL !== dL) {
                if (tabuleiro[tempL][tempC] !== '') return false;
                tempL += passoL;
                tempC += passoC;
            }
            return true;
        }

        function movimentoRainha(oL, oC, dL, dC) {
            return movimentoTorre(oL, oC, dL, dC) || movimentoBispo(oL, oC, dL, dC);
        }

        function movimentoRei(oL, oC, dL, dC) {
            const deltaL = Math.abs(dL - oL);
            const deltaC = Math.abs(dC - oC);
            return (deltaL <= 1 && deltaC <= 1);
        }

        function trocarTurno() {
            turno = turno === 'branco' ? 'preto' : 'branco';
            mensagemEl.textContent = `É a vez das ${turno === 'branco' ? 'Brancas' : 'Pretas'}`;
        }

        reiniciarJogo();
    </script>
</body>
</html>