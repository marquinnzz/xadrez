<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xadrez Completo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #4682B4;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .tabuleiro {
            display: grid;
            grid-template-columns: repeat(8, 70px);
            grid-template-rows: repeat(8, 70px);
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .casa {
            width: 70px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            cursor: pointer;
            position: relative;
        }
        .clara { background-color: #f0d9b5; }
        .escura { background-color: #b58863; }
        .selecionada { background-color: #ffcc00 !important; }
        .xeque { background-color: #FF0000 !important; }
        .peca.branca { color: #FFFFFF; text-shadow: 1px 1px 2px #000; }
        .peca.preta { color: #333333; }
        .guia-movimento {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: green;
            border-radius: 50%;
            pointer-events: none;
        }
        
        #mensagem {
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px #000;
        }
        .opcoes-jogo {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #337ab7;
            color: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Xadrez Simples</h1>
    <div class="container">
        <div class="opcoes-jogo">
            <button onclick="definirModo('amigo')">Jogar contra amigo</button>
            <button onclick="definirModo('ia')">Jogar contra IA</button>
        </div>
        <div class="tabuleiro" id="tabuleiro"></div>
        <div id="mensagem">É a vez das Brancas</div>
        <button onclick="reiniciarJogo()">Reiniciar Jogo</button>
    </div>

    <script>
        const tabuleiroEl = document.getElementById('tabuleiro');
        const mensagemEl = document.getElementById('mensagem');
        
        const pecasUnicode = {
            'r': '&#9820;', 'n': '&#9822;', 'b': '&#9821;', 'q': '&#9819;', 'k': '&#9818;', 'p': '&#9823;',
            'R': '&#9814;', 'N': '&#9816;', 'B': '&#9815;', 'Q': '&#9813;', 'K': '&#9812;', 'P': '&#9817;'
        };

        const pecasValor = { 'p': 10, 'r': 50, 'n': 30, 'b': 30, 'q': 90, 'k': 900 };

        let tabuleiro;
        let turno;
        let pecaSelecionada;
        let modoDeJogo = 'amigo';
        let jogoTerminado = false;

        function definirModo(modo) {
            modoDeJogo = modo;
            alert(`Modo de jogo definido para: ${modo}. Reinicie o jogo para aplicar.`);
        }

        function reiniciarJogo() {
            tabuleiro = [
                ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
                ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
                ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
            ];
            turno = 'branco';
            pecaSelecionada = null;
            jogoTerminado = false;
            mensagemEl.textContent = 'É a vez das Brancas';
            renderizarTabuleiro();
        }

        function renderizarTabuleiro() {
            tabuleiroEl.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const casaEl = document.createElement('div');
                    casaEl.classList.add('casa');
                    casaEl.classList.add((i + j) % 2 === 0 ? 'clara' : 'escura');
                    casaEl.dataset.linha = i;
                    casaEl.dataset.coluna = j;
                    
                    const peca = tabuleiro[i][j];
                    if (peca) {
                        const pecaEl = document.createElement('span');
                        pecaEl.classList.add('peca');
                        pecaEl.classList.add(peca === peca.toUpperCase() ? 'branca' : 'preta');
                        pecaEl.innerHTML = pecasUnicode[peca];
                        casaEl.appendChild(pecaEl);
                    }
                    
                    casaEl.addEventListener('click', () => handleClick(i, j));
                    tabuleiroEl.appendChild(casaEl);
                }
            }
            if (pecaSelecionada) {
                mostrarMovimentosValidos(pecaSelecionada[0], pecaSelecionada[1]);
            }
            if (estaEmXeque(turno)) {
                const [reiL, reiC] = obterPosicaoRei(turno);
                const casaRei = document.querySelector(`.casa[data-linha="${reiL}"][data-coluna="${reiC}"]`);
                casaRei.classList.add('xeque');
            }
        }

        function mostrarMovimentosValidos(linha, coluna) {
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const peca = tabuleiro[linha][coluna];
                    if (movimentoValido(peca, linha, coluna, i, j)) {
                        const casaAlvo = document.querySelector(`.casa[data-linha="${i}"][data-coluna="${j}"]`);
                        const guia = document.createElement('div');
                        guia.classList.add('guia-movimento');
                        casaAlvo.appendChild(guia);
                    }
                }
            }
        }

        function handleClick(linha, coluna) {
            if (jogoTerminado) return;
            const pecaNaCasa = tabuleiro[linha][coluna];

            if (pecaSelecionada) {
                const [pecaLinha, pecaColuna] = pecaSelecionada;
                const peca = tabuleiro[pecaLinha][pecaColuna];

                if (movimentoValido(peca, pecaLinha, pecaColuna, linha, coluna)) {
                    tabuleiro[linha][coluna] = peca;
                    tabuleiro[pecaLinha][pecaColuna] = '';
                    trocarTurno();
                    if (modoDeJogo === 'ia' && turno === 'preto') {
                        setTimeout(moverIA, 500);
                    }
                }

                pecaSelecionada = null;
                renderizarTabuleiro();
            } else {
                if (pecaNaCasa && ((turno === 'branco' && pecaNaCasa === pecaNaCasa.toUpperCase()) || (turno === 'preto' && pecaNaCasa === pecaNaCasa.toLowerCase()))) {
                    pecaSelecionada = [linha, coluna];
                    const casaSelecionada = document.querySelector(`.casa[data-linha="${linha}"][data-coluna="${coluna}"]`);
                    casaSelecionada.classList.add('selecionada');
                    renderizarTabuleiro();
                }
            }
        }

        // --- Lógica da IA ---
        function moverIA() {
            const { melhorMovimento, melhorScore } = minimax(tabuleiro, 2, -Infinity, Infinity, true);
            if (melhorMovimento) {
                const { from, to } = melhorMovimento;
                tabuleiro[to.linha][to.coluna] = tabuleiro[from.linha][from.coluna];
                tabuleiro[from.linha][from.coluna] = '';
                trocarTurno();
            }
            renderizarTabuleiro();
        }

        function minimax(tabuleiro, profundidade, alpha, beta, maximizando) {
            if (profundidade === 0) {
                return { melhorScore: avaliarTabuleiro(tabuleiro) };
            }

            const movimentosPossiveis = obterTodosMovimentos(tabuleiro, maximizando ? 'preto' : 'branco');

            if (maximizando) {
                let melhorScore = -Infinity;
                let melhorMovimento = null;
                for (const mov of movimentosPossiveis) {
                    const novoTabuleiro = fazerMovimento(tabuleiro, mov);
                    const resultado = minimax(novoTabuleiro, profundidade - 1, alpha, beta, false);
                    if (resultado.melhorScore > melhorScore) {
                        melhorScore = resultado.melhorScore;
                        melhorMovimento = mov;
                    }
                    alpha = Math.max(alpha, melhorScore);
                    if (beta <= alpha) break;
                }
                return { melhorScore, melhorMovimento };
            } else {
                let melhorScore = Infinity;
                let melhorMovimento = null;
                for (const mov of movimentosPossiveis) {
                    const novoTabuleiro = fazerMovimento(tabuleiro, mov);
                    const resultado = minimax(novoTabuleiro, profundidade - 1, alpha, beta, true);
                    if (resultado.melhorScore < melhorScore) {
                        melhorScore = resultado.melhorScore;
                        melhorMovimento = mov;
                    }
                    beta = Math.min(beta, melhorScore);
                    if (beta <= alpha) break;
                }
                return { melhorScore, melhorMovimento };
            }
        }

        function avaliarTabuleiro(tabuleiro) {
            let pontuacao = 0;
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const peca = tabuleiro[i][j];
                    if (peca) {
                        const valor = pecasValor[peca.toLowerCase()] || 0;
                        if (peca === peca.toUpperCase()) {
                            pontuacao -= valor;
                        } else {
                            pontuacao += valor;
                        }
                    }
                }
            }
            return pontuacao;
        }

        function obterTodosMovimentos(tabuleiro, cor) {
            const movimentos = [];
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const peca = tabuleiro[i][j];
                    if (peca && ((cor === 'branco' && peca === peca.toUpperCase()) || (cor === 'preto' && peca === peca.toLowerCase()))) {
                        for (let dL = 0; dL < 8; dL++) {
                            for (let dC = 0; dC < 8; dC++) {
                                if (movimentoValido(peca, i, j, dL, dC)) {
                                    movimentos.push({ from: { linha: i, coluna: j }, to: { linha: dL, coluna: dC } });
                                }
                            }
                        }
                    }
                }
            }
            return movimentos;
        }
        
        function fazerMovimento(tabuleiro, movimento) {
            const novoTabuleiro = tabuleiro.map(row => [...row]);
            const { from, to } = movimento;
            novoTabuleiro[to.linha][to.coluna] = novoTabuleiro[from.linha][from.coluna];
            novoTabuleiro[from.linha][from.coluna] = '';
            return novoTabuleiro;
        }

        function movimentoValido(peca, origemLinha, origemColuna, destinoLinha, destinoColuna) {
            const pecaDestino = tabuleiro[destinoLinha][destinoColuna];
            if (pecaDestino) {
                const corOrigem = peca === peca.toUpperCase() ? 'branco' : 'preto';
                const corDestino = pecaDestino === pecaDestino.toUpperCase() ? 'branco' : 'preto';
                if (corOrigem === corDestino) return false;
            }

            const pecaTipo = peca.toLowerCase();

            switch (pecaTipo) {
                case 'p': return movimentoPeao(peca, origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'r': return movimentoTorre(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'n': return movimentoCavalo(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'b': return movimentoBispo(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'q': return movimentoRainha(origemLinha, origemColuna, destinoLinha, destinoColuna);
                case 'k': return movimentoRei(origemLinha, origemColuna, destinoLinha, destinoColuna);
                default: return false;
            }
        }

        // Funções de verificação de xeque
        function obterPosicaoRei(cor) {
            const reiPeca = cor === 'branco' ? 'K' : 'k';
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    if (tabuleiro[i][j] === reiPeca) {
                        return [i, j];
                    }
                }
            }
        }
        
        function estaEmXeque(cor) {
            const [reiL, reiC] = obterPosicaoRei(cor);
            const corInimiga = cor === 'branco' ? 'preto' : 'branco';
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const peca = tabuleiro[i][j];
                    if (peca && ((corInimiga === 'branco' && peca === peca.toUpperCase()) || (corInimiga === 'preto' && peca === peca.toLowerCase()))) {
                        if (movimentoValido(peca, i, j, reiL, reiC)) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        function verificarXequeMate(cor) {
            if (!estaEmXeque(cor)) return false;

            const movimentosPossiveis = obterTodosMovimentos(tabuleiro, cor);
            for (const mov of movimentosPossiveis) {
                const tempTab = fazerMovimento(tabuleiro, mov);
                const tempTurno = cor;
                if (!estaEmXeque(tempTurno, tempTab)) {
                    return false;
                }
            }
            return true;
        }
        
        function trocarTurno() {
            turno = turno === 'branco' ? 'preto' : 'branco';
            const corAtual = turno === 'branco' ? 'Brancas' : 'Pretas';
            mensagemEl.textContent = `É a vez das ${corAtual}`;
            if (verificarXequeMate(turno)) {
                jogoTerminado = true;
                mensagemEl.textContent = `Xeque-Mate! ${corAtual} perderam!`;
            }
        }
        
        // Funções de movimento para cada peça
        // (mantive o mesmo código das funções de movimento anteriores)
        function movimentoPeao(peca, oL, oC, dL, dC) {
            const direcao = (peca === peca.toUpperCase()) ? -1 : 1;
            const linhaInicial = (peca === peca.toUpperCase()) ? 6 : 1;
            if (oL + direcao === dL && oC === dC && tabuleiro[dL][dC] === '') return true;
            if (oL === linhaInicial && oL + 2 * direcao === dL && oC === dC && tabuleiro[dL][dC] === '' && tabuleiro[oL + direcao][oC] === '') return true;
            if (oL + direcao === dL && Math.abs(oC - dC) === 1 && tabuleiro[dL][dC] !== '') return true;
            return false;
        }

        function movimentoTorre(oL, oC, dL, dC) {
            if (oL !== dL && oC !== dC) return false;
            const deltaL = dL - oL;
            const deltaC = dC - oC;
            const passoL = Math.sign(deltaL);
            const passoC = Math.sign(deltaC);
            let tempL = oL + passoL;
            let tempC = oC + passoC;
            while (tempL !== dL || tempC !== dC) {
                if (tabuleiro[tempL][tempC] !== '') return false;
                tempL += passoL;
                tempC += passoC;
            }
            return true;
        }

        function movimentoCavalo(oL, oC, dL, dC) {
            const deltaL = Math.abs(dL - oL);
            const deltaC = Math.abs(dC - oC);
            return (deltaL === 2 && deltaC === 1) || (deltaL === 1 && deltaC === 2);
        }

        function movimentoBispo(oL, oC, dL, dC) {
            if (Math.abs(dL - oL) !== Math.abs(dC - oC)) return false;
            const deltaL = dL - oL;
            const deltaC = dC - oC;
            const passoL = Math.sign(deltaL);
            const passoC = Math.sign(deltaC);
            let tempL = oL + passoL;
            let tempC = oC + passoC;
            while (tempL !== dL) {
                if (tabuleiro[tempL][tempC] !== '') return false;
                tempL += passoL;
                tempC += passoC;
            }
            return true;
        }

        function movimentoRainha(oL, oC, dL, dC) {
            return movimentoTorre(oL, oC, dL, dC) || movimentoBispo(oL, oC, dL, dC);
        }

        function movimentoRei(oL, oC, dL, dC) {
            const deltaL = Math.abs(dL - oL);
            const deltaC = Math.abs(dC - oC);
            return (deltaL <= 1 && deltaC <= 1);
        }

        reiniciarJogo();
    </script>
</body>
</html>